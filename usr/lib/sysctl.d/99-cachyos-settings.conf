# The sysctl swappiness parameter determines the kernel's preference for pushing anonymous pages or page cache to disk in memory-starved situations.
# A low value causes the kernel to prefer freeing up open files (page cache), a high value causes the kernel to try to use swap space,
# and a value of 100 means IO cost is assumed to be equal.
vm.swappiness = 100

# The value controls the tendency of the kernel to reclaim the memory which is used for caching of directory and inode objects (VFS cache).
# Lowering it from the default value of 100 makes the kernel less inclined to reclaim VFS cache (do not set it to 0, this may produce out-of-memory conditions)
vm.vfs_cache_pressure = 50

# Contains, as bytes, the number of pages at which a process which is
# generating disk writes will itself start writing out dirty data.
vm.dirty_bytes = 268435456

# page-cluster controls the number of pages up to which consecutive pages are read in from swap in a single attempt.
# This is the swap counterpart to page cache readahead. The mentioned consecutivity is not in terms of virtual/physical addresses,
# but consecutive on swap space - that means they were swapped out together. (Default is 3)
# increase this value to 1 or 2 if you are using physical swap (1 if ssd, 2 if hdd)
vm.page-cluster = 0

# Contains, as bytes, the number of pages at which the background kernel
# flusher threads will start writing out dirty data.
vm.dirty_background_bytes = 67108864

# The kernel flusher threads will periodically wake up and write old data out to disk.Â  This
# tunable expresses the interval between those wakeups, in 100'ths of a second (Default is 500).
vm.dirty_writeback_centisecs = 1500

# This action will speed up your boot and shutdown, because one less module is loaded. Additionally disabling watchdog timers increases performance and lowers power consumption
# Disable NMI watchdog
kernel.nmi_watchdog = 0

# Enable the sysctl setting kernel.unprivileged_userns_clone to allow normal users to run unprivileged containers.
kernel.unprivileged_userns_clone = 1

# To hide any kernel messages from the console
kernel.printk = 3 3 3 3

# Restricting access to kernel pointers in the proc filesystem
kernel.kptr_restrict = 2

# Set size of file handles and inode cache
# (Often tweaked alongside network settings for high-concurrency apps)
fs.file-max = 2097152

# ==============================================================================
#   UNIVERSAL NETWORK TUNING (Performance & Stability)
#   Optimized for: Low-Latency Gaming, VPNs, and Container Routing
# ==============================================================================

# --- 1. IP Forwarding (Routing Support) ---
# Enables IPv4 packet forwarding.
# Benefit: Necessary for functionality in Containers and VPN Mesh networks.
# Use Case: Required for Tailscale/ProtonVPN (Exit Nodes/Subnet Routers) and Docker/Podman containers.
net.ipv4.ip_forward = 1

# --- 2. MTU Probing (Connection Stability) ---
# Enables Path MTU Discovery.
# Benefit: Essential for connections involving encapsulation (VPNs) where the MTU is < 1500.
# Use Case: Fixes "black hole" connections and stalled transfers in WireGuard, OpenVPN, or mobile networks.
net.ipv4.tcp_mtu_probing = 1

# --- 3. TCP Timewait Reuse (Socket Efficiency) ---
# Allows reusing sockets in TIME_WAIT state for new connections.
# Benefit: Prevents "Port Exhaustion" during high connection turnover.
# Use Case: Improves performance for P2P apps (Syncthing/Torrents) and web servers.
net.ipv4.tcp_tw_reuse = 1

# --- 4. Input Packet Queue (Burst Handling) ---
# Increases the backlog queue for incoming packets.
# Benefit: Prevents losing packets when the interface receives data faster than the kernel can process it.
# Use Case: Smoother playback in streaming apps and better handling of high-speed downloads (Gigabit+).
net.core.netdev_max_backlog = 4096
